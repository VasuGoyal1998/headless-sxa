import { execSync } from 'child_process';
const trackedScopes = ['@sitecore', '@sitecore-cloudsdk', '@sitecore-feaas', '@sitecore-jss'];
/**
 * Get application metadata
 */
export function getMetadata() {
    const metadata = { packages: {} };
    let queryResult = [];
    try {
        queryResult = JSON.parse(execSync('npm query [name*=@sitecore] --workspaces false').toString());
    }
    catch (error) {
        console.error('Failed to retrieve sitecore packages using npm query', error);
        return metadata;
    }
    metadata.packages = getPackagesFromQueryResult(queryResult);
    return metadata;
}
/**
 * Retrieve all packages of the tracked scopes with their exact versions
 * @param {Package[]} scPackages list of packages
 * @returns {Record<string, string>} an object with the packages with their exact versions
 */
function getPackagesFromQueryResult(scPackages) {
    const packages = {};
    scPackages.forEach((scPackage) => {
        if (trackedScopes.some((trackedScope) => scPackage.name.startsWith(trackedScope))) {
            packages[scPackage.name] = scPackage.version;
        }
    });
    return packages;
}
