"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.digest = digest;
exports.hmac = hmac;
const crypto_1 = require("crypto");
const fs_1 = require("fs");
/**
 * @param {string} path
 */
function digest(path) {
    return new Promise((resolve, reject) => {
        const hash = (0, crypto_1.createHash)('sha256');
        (0, fs_1.createReadStream)(path)
            .pipe(hash.setEncoding('base64'))
            .on('error', (err) => reject(err))
            .on('finish', () => resolve(hash.read()));
    });
}
/**
 * @param {string[]} factors
 * @param {string} secret
 */
function hmac(factors, secret) {
    const mac = (0, crypto_1.createHmac)('sha256', secret);
    mac.setEncoding('base64');
    mac.write(factors.map((factor) => factor.toLowerCase()).join('|'));
    mac.end();
    return mac.read();
}
