"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.packageGenerate = packageGenerate;
const update_1 = require("./update");
const fs_extra_1 = __importDefault(require("fs-extra"));
const path_1 = __importDefault(require("path"));
/**
 * @param {PackageGenerateOptions} options
 */
function packageGenerate(options) {
    // clear output folder
    fs_extra_1.default.emptyDirSync(options.outputPath);
    const datepath = `${new Date().getTime()}`;
    // manifest at temp path, need to save path for adding to metadata
    const manifestRelativePath = path_1.default.join('.', 'temp', options.appName, datepath);
    const packageManifestPath = path_1.default.join('.', options.outputPath, manifestRelativePath);
    fs_extra_1.default.copySync(path_1.default.join('.', options.manifestPath), packageManifestPath);
    // generate manifest package
    const updatePackage = path_1.default.join(options.outputPath, `${options.appName}.${datepath}.manifest.zip`);
    return new Promise((resolve) => {
        (0, update_1.createPackage)(packageManifestPath, updatePackage, () => resolve(null));
    });
}
